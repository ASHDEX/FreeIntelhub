<%- include('partials/head') %>

<section class="hero">
  <h1>Threat Intelligence Feed</h1>
  <p>Aggregating <%= totalCount %> articles from trusted cybersecurity sources</p>
  <div class="search-box">
    <form action="/search" method="GET" autocomplete="off">
      <div class="search-wrapper">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="hero-search" name="q" placeholder="Search threats, vendors, CVEs..." value="">
        <kbd class="search-hint">/</kbd>
      </div>
    </form>
    <div class="suggestions" id="suggestions"></div>
  </div>
</section>

<% if (cves && cves.length > 0) { %>
<section class="cve-ticker-section">
  <div class="cve-ticker-label">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="cve-icon"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
    LATEST CVEs
  </div>
  <div class="cve-ticker-wrapper">
    <div class="cve-ticker-track" id="cve-ticker">
      <% cves.forEach(function(cve) { %>
        <a href="<%= cve.link %>" target="_blank" rel="noopener noreferrer" class="cve-ticker-item">
          <span class="cve-id<% if (cve.severity === 'CRITICAL') { %> cve-critical<% } else if (cve.severity === 'HIGH') { %> cve-high<% } else if (cve.severity === 'MEDIUM') { %> cve-medium<% } %>"><%= cve.id %></span>
          <span class="cve-desc"><%= cve.description %></span>
        </a>
      <% }); %>
      <% cves.forEach(function(cve) { %>
        <a href="<%= cve.link %>" target="_blank" rel="noopener noreferrer" class="cve-ticker-item" aria-hidden="true">
          <span class="cve-id<% if (cve.severity === 'CRITICAL') { %> cve-critical<% } else if (cve.severity === 'HIGH') { %> cve-high<% } else if (cve.severity === 'MEDIUM') { %> cve-medium<% } %>"><%= cve.id %></span>
          <span class="cve-desc"><%= cve.description %></span>
        </a>
      <% }); %>
    </div>
  </div>
</section>
<% } %>

<section class="stats-row">
  <% categories.slice(0, 6).forEach(function(c) { %>
    <a href="/category/<%= encodeURIComponent(c.category) %>" class="stat-card">
      <strong><%= c.count %></strong>
      <span><%= c.category %></span>
    </a>
  <% }); %>
</section>

<% if (vendors.length > 0) { %>
<section class="vendor-bar">
  <h2>Trending Vendors</h2>
  <div class="vendor-tags">
    <% vendors.slice(0, 15).forEach(function(v) { %>
      <a href="/vendor/<%= encodeURIComponent(v.vendor) %>" class="badge badge-vendor"><%= v.vendor %> (<%= v.count %>)</a>
    <% }); %>
  </div>
</section>
<% } %>

<section>
  <div class="section-header">
    <h2>Latest News</h2>
  </div>
  <%- include('partials/articleList', { articles }) %>
  <%- include('partials/pagination', { page: newsPage, pages: newsPages, baseUrl: '/?section=news' }) %>
</section>

<section>
  <div class="section-header">
    <h2>Data Breaches</h2>
  </div>
  <%- include('partials/articleList', { articles: breachArticles }) %>
  <%- include('partials/pagination', { page: breachPage, pages: breachPages, baseUrl: '/?section=breaches' }) %>
</section>

<%- include('partials/footer') %>
