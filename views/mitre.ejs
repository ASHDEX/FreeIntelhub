<%- include('partials/head', { pageTitle: 'MITRE ATT&CK' }) %>

<div class="page-header">
  <h1>MITRE ATT&CK Mapping</h1>
  <p>Articles mapped to MITRE ATT&CK techniques. Select a technique to view matching articles.</p>
</div>

<% if (technique) { %>
  <div class="mitre-active-filter" id="mitre-results">
    <div class="mitre-filter-header">
      <h2><%= technique %> â€” <% var techInfo = mitreTechniques[technique]; if (techInfo) { %><%= techInfo.name %> (<%= techInfo.tactic %>)<% } %></h2>
      <a href="/mitre" class="btn btn-sm">Clear filter</a>
    </div>
    <p class="mitre-result-count"><%= total %> article<%= total !== 1 ? 's' : '' %> found</p>
    <%- include('partials/articleList', { articles: articles }) %>
    <% if (pages > 1) { %>
      <%- include('partials/pagination', { page: page, pages: pages, baseUrl: baseUrl }) %>
    <% } %>
  </div>
<% } %>

<% var tactics = {};
   Object.keys(mitreTechniques).forEach(function(id) {
     var t = mitreTechniques[id];
     if (!tactics[t.tactic]) tactics[t.tactic] = [];
     tactics[t.tactic].push({ id: id, name: t.name });
   });
%>

<div class="mitre-tactics">
  <% Object.keys(tactics).forEach(function(tactic) { %>
    <div class="mitre-tactic-group">
      <h3 class="mitre-tactic-name"><%= tactic %></h3>
      <div class="mitre-technique-list">
        <% tactics[tactic].forEach(function(tech) { %>
          <a href="/mitre?technique=<%= encodeURIComponent(tech.id) %>" class="badge badge-mitre<%= technique === tech.id ? ' badge-mitre-active' : '' %>"><%= tech.id %> <span class="mitre-tech-name"><%= tech.name %></span></a>
        <% }); %>
      </div>
    </div>
  <% }); %>
</div>

<%- include('partials/footer') %>
