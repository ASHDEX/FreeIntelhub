<%- include('partials/head', { pageTitle: 'Vulnerability & Exploit Lookup' }) %>

<!-- Hero search section â€” vertically centered before results, collapses after -->
<div id="vuln-hero" class="vuln-hero">
  <div class="vuln-hero-inner">
    <div class="vuln-hero-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    </div>
    <h1 class="vuln-hero-title">Vulnerability & Exploit Lookup</h1>
    <p class="vuln-hero-subtitle">Search any CVE across 40+ vulnerability databases, exploit repositories, and threat intel sources.</p>

    <div class="vuln-search-box">
      <div class="vuln-search-wrapper">
        <svg class="vuln-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="vuln-search-input" placeholder="Enter CVE ID (e.g. CVE-2024-21887)..." autocomplete="off" spellcheck="false" value="<%= typeof query !== 'undefined' ? query : '' %>">
        <button id="vuln-search-btn" class="vuln-search-btn" disabled>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        </button>
      </div>
      <div id="vuln-suggestions" class="vuln-suggestions"></div>
      <p class="vuln-search-hint">Type a CVE ID like <code>CVE-2024-3400</code> or <code>CVE-2023-44228</code> &mdash; press Enter to search</p>
    </div>
  </div>
</div>

<!-- Loading state -->
<div id="vuln-loading" class="vuln-loading" style="display:none;">
  <div class="vuln-spinner"></div>
  <p>Querying NVD, MITRE, GitHub Advisory, OSV.dev, CISA KEV and more...</p>
</div>

<!-- Error state -->
<div id="vuln-error" class="vuln-error" style="display:none;"></div>

<!-- Results container -->
<div id="vuln-results" style="display:none;">

  <!-- ===== 1. CVE Overview Card ===== -->
  <div id="vuln-header-card" class="vuln-card vuln-header-card"></div>

  <!-- ===== 2. Exploitation & PoC Status Panel ===== -->
  <div class="vuln-panel vuln-panel-status">
    <h2 class="vuln-panel-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
      Exploitation & PoC Status
    </h2>
    <div id="vuln-exploit-status" class="vuln-status-grid"></div>
  </div>

  <!-- ===== 3. CISA KEV details ===== -->
  <div id="vuln-cisa" class="vuln-card vuln-cisa-card" style="display:none;"></div>

  <!-- ===== 4. Source Results ===== -->
  <div class="vuln-panel">
    <h2 class="vuln-panel-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
      Source Results
    </h2>
    <div id="vuln-source-cards" class="vuln-source-grid"></div>
  </div>

  <!-- ===== 5. Affected Packages ===== -->
  <div id="vuln-affected" class="vuln-card" style="display:none;">
    <h3 class="vuln-card-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
      Affected Packages
    </h3>
    <div id="vuln-affected-list"></div>
  </div>

  <!-- ===== 6. References ===== -->
  <div id="vuln-references" class="vuln-card" style="display:none;">
    <h3 class="vuln-card-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
      References
    </h3>
    <div id="vuln-refs-list"></div>
  </div>

  <!-- ===== 7. External Database Links ===== -->
  <div class="vuln-panel vuln-panel-links">
    <h2 class="vuln-panel-title">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
      Lookup in 40+ Databases
    </h2>

    <h3 class="vuln-subsection-title">Vulnerability Databases</h3>
    <div id="vuln-db-links" class="vuln-link-grid"></div>

    <h3 class="vuln-subsection-title">Exploit & PoC Databases</h3>
    <div id="vuln-exploit-links" class="vuln-link-grid"></div>
  </div>

</div>

<script>
(function() {
  var hero = document.getElementById('vuln-hero');
  var input = document.getElementById('vuln-search-input');
  var btn = document.getElementById('vuln-search-btn');
  var sugBox = document.getElementById('vuln-suggestions');
  var loading = document.getElementById('vuln-loading');
  var errorEl = document.getElementById('vuln-error');
  var results = document.getElementById('vuln-results');

  var CVE_RE = /^CVE-\d{4}-\d{4,}$/i;
  var PARTIAL_RE = /^(C|CV|CVE|CVE-|CVE-\d{0,4}|CVE-\d{4}-|CVE-\d{4}-\d{0,})$/i;
  var debounce = null;

  function escHtml(s) { var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

  // Validate and enable button
  input.addEventListener('input', function() {
    var v = input.value.trim();
    btn.disabled = !CVE_RE.test(v);

    clearTimeout(debounce);
    if (v.length === 0) { sugBox.innerHTML = ''; sugBox.style.display = 'none'; return; }

    if (CVE_RE.test(v)) {
      sugBox.innerHTML = '<div class="vuln-sug-item vuln-sug-valid" tabindex="0" data-cve="' + escHtml(v.toUpperCase()) + '">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>'
        + '<span>Lookup <strong>' + escHtml(v.toUpperCase()) + '</strong></span>'
        + '<span class="vuln-sug-hint">Press Enter</span>'
        + '</div>';
      sugBox.style.display = 'block';
    } else if (PARTIAL_RE.test(v)) {
      sugBox.innerHTML = '<div class="vuln-sug-item vuln-sug-typing">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>'
        + '<span>Keep typing... <code>CVE-YYYY-NNNNN</code></span>'
        + '</div>';
      sugBox.style.display = 'block';

      debounce = setTimeout(function() {
        if (/^CVE-\d{4}-\d{1,}$/i.test(v)) {
          fetchSuggestions(v.toUpperCase());
        }
      }, 300);
    } else {
      sugBox.innerHTML = '<div class="vuln-sug-item vuln-sug-invalid">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>'
        + '<span>Invalid format. Use <code>CVE-YYYY-NNNNN</code></span>'
        + '</div>';
      sugBox.style.display = 'block';
    }
  });

  function fetchSuggestions(partial) {
    fetch('/api/cves')
      .then(function(r) { return r.json(); })
      .then(function(cves) {
        var matches = cves.filter(function(c) {
          return c.id && c.id.startsWith(partial);
        }).slice(0, 5);
        if (matches.length === 0) return;
        var html = matches.map(function(c) {
          var sevClass = c.severity ? ' vuln-sev-' + c.severity.toLowerCase() : '';
          return '<div class="vuln-sug-item vuln-sug-cve" tabindex="0" data-cve="' + escHtml(c.id) + '">'
            + '<span class="vuln-sug-cve-id">' + escHtml(c.id) + '</span>'
            + (c.severity ? '<span class="vuln-sug-sev' + sevClass + '">' + escHtml(c.severity) + '</span>' : '')
            + '<span class="vuln-sug-desc">' + escHtml(c.description || '') + '</span>'
            + '</div>';
        }).join('');
        sugBox.innerHTML = sugBox.innerHTML + html;
      })
      .catch(function() {});
  }

  // Click on suggestion
  sugBox.addEventListener('click', function(e) {
    var item = e.target.closest('[data-cve]');
    if (item) {
      input.value = item.getAttribute('data-cve');
      btn.disabled = false;
      sugBox.style.display = 'none';
      doLookup(item.getAttribute('data-cve'));
    }
  });

  // Enter key
  input.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      var v = input.value.trim();
      if (CVE_RE.test(v)) {
        sugBox.style.display = 'none';
        doLookup(v.toUpperCase());
      }
    }
  });

  btn.addEventListener('click', function() {
    var v = input.value.trim();
    if (CVE_RE.test(v)) {
      sugBox.style.display = 'none';
      doLookup(v.toUpperCase());
    }
  });

  // Close suggestions on outside click
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.vuln-search-box')) { sugBox.style.display = 'none'; }
  });

  function doLookup(cveId) {
    // Collapse hero to compact mode
    hero.classList.add('vuln-hero-compact');
    loading.style.display = 'flex';
    errorEl.style.display = 'none';
    results.style.display = 'none';

    history.replaceState(null, '', '/vulnerability?cve=' + encodeURIComponent(cveId));

    fetch('/api/vuln/' + encodeURIComponent(cveId))
      .then(function(r) {
        if (!r.ok) return r.json().then(function(j) { throw new Error(j.error || 'Lookup failed'); });
        return r.json();
      })
      .then(function(json) {
        loading.style.display = 'none';
        renderResults(json.data);
      })
      .catch(function(err) {
        loading.style.display = 'none';
        errorEl.style.display = 'block';
        errorEl.innerHTML = '<p>' + escHtml(err.message || 'Something went wrong. Please try again.') + '</p>';
      });
  }

  function renderResults(data) {
    results.style.display = 'block';

    // ===== Header card =====
    var sevClass = data.severity ? 'vuln-severity-' + data.severity.toLowerCase() : '';
    var headerHtml = '<div class="vuln-header-top">'
      + '<a href="' + escHtml(data.link) + '" target="_blank" rel="noopener noreferrer" class="vuln-header-id">' + escHtml(data.id) + '</a>';

    if (data.severity) {
      headerHtml += '<span class="vuln-severity-badge ' + sevClass + '">'
        + escHtml(data.severity) + (data.score ? ' ' + data.score : '') + '</span>';
    }
    headerHtml += '</div>';

    if (data.description) {
      headerHtml += '<p class="vuln-header-desc">' + escHtml(data.description) + '</p>';
    }

    headerHtml += '<div class="vuln-header-meta">';
    if (data.published) headerHtml += '<span><strong>Published:</strong> ' + new Date(data.published).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) + '</span>';
    if (data.lastModified) headerHtml += '<span><strong>Modified:</strong> ' + new Date(data.lastModified).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) + '</span>';
    if (data.vector) headerHtml += '<span class="vuln-vector"><strong>Vector:</strong> <code>' + escHtml(data.vector) + '</code></span>';
    headerHtml += '</div>';

    if (data.weaknesses && data.weaknesses.length > 0) {
      headerHtml += '<div class="vuln-weaknesses">';
      data.weaknesses.forEach(function(w) {
        headerHtml += '<span class="vuln-cwe-badge">' + escHtml(w) + '</span>';
      });
      headerHtml += '</div>';
    }
    document.getElementById('vuln-header-card').innerHTML = headerHtml;

    // ===== Exploitation & PoC status =====
    var statusHtml = '';

    // Exploited in the wild
    statusHtml += '<div class="vuln-status-card ' + (data.exploitedInWild ? 'vuln-status-danger' : 'vuln-status-safe') + '">'
      + '<div class="vuln-status-icon">'
      + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">'
      + (data.exploitedInWild
        ? '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>'
        : '<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>')
      + '</svg>'
      + '</div>'
      + '<div class="vuln-status-text">'
      + '<span class="vuln-status-label">Exploited in the Wild</span>'
      + '<span class="vuln-status-value">' + (data.exploitedInWild ? 'YES &mdash; Listed in CISA KEV' : 'Not in CISA Known Exploited Vulnerabilities') + '</span>'
      + '</div>'
      + '</div>';

    // PoC / Exploit presence
    statusHtml += '<div class="vuln-status-card ' + (data.hasKnownExploit ? 'vuln-status-warn' : 'vuln-status-safe') + '">'
      + '<div class="vuln-status-icon">'
      + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">'
      + (data.hasKnownExploit
        ? '<path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>'
        : '<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>')
      + '</svg>'
      + '</div>'
      + '<div class="vuln-status-text">'
      + '<span class="vuln-status-label">PoC / Exploit Available</span>'
      + '<span class="vuln-status-value">' + (data.hasKnownExploit ? 'YES &mdash; Public exploit or PoC references found' : 'No known public PoC or exploit references') + '</span>'
      + '</div>'
      + '</div>';

    // Ransomware use (from CISA KEV)
    if (data.cisaKev) {
      var ransomware = data.cisaKev.knownRansomwareCampaignUse || 'Unknown';
      var isRansomware = ransomware.toLowerCase() === 'known';
      statusHtml += '<div class="vuln-status-card ' + (isRansomware ? 'vuln-status-danger' : 'vuln-status-neutral') + '">'
        + '<div class="vuln-status-icon">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>'
        + '</div>'
        + '<div class="vuln-status-text">'
        + '<span class="vuln-status-label">Ransomware Campaign Use</span>'
        + '<span class="vuln-status-value">' + escHtml(ransomware) + '</span>'
        + '</div>'
        + '</div>';
    }

    document.getElementById('vuln-exploit-status').innerHTML = statusHtml;

    // ===== CISA KEV details =====
    var cisaEl = document.getElementById('vuln-cisa');
    if (data.cisaKev) {
      var k = data.cisaKev;
      cisaEl.style.display = 'block';
      cisaEl.innerHTML = '<h3 class="vuln-card-title vuln-cisa-title">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>'
        + 'CISA Known Exploited Vulnerability'
        + '</h3>'
        + '<div class="vuln-cisa-grid">'
        + '<div class="vuln-cisa-field"><span class="vuln-cisa-key">Vendor</span><span class="vuln-cisa-val">' + escHtml(k.vendorProject) + '</span></div>'
        + '<div class="vuln-cisa-field"><span class="vuln-cisa-key">Product</span><span class="vuln-cisa-val">' + escHtml(k.product) + '</span></div>'
        + '<div class="vuln-cisa-field"><span class="vuln-cisa-key">Date Added</span><span class="vuln-cisa-val">' + escHtml(k.dateAdded) + '</span></div>'
        + '<div class="vuln-cisa-field"><span class="vuln-cisa-key">Due Date</span><span class="vuln-cisa-val">' + escHtml(k.dueDate) + '</span></div>'
        + '</div>'
        + '<p class="vuln-cisa-desc">' + escHtml(k.shortDescription) + '</p>'
        + (k.requiredAction ? '<div class="vuln-cisa-action"><strong>Required Action:</strong> ' + escHtml(k.requiredAction) + '</div>' : '');
    } else {
      cisaEl.style.display = 'none';
    }

    // ===== Source result cards =====
    var sourceHtml = '';
    var sources = data.sources;
    var sourceList = [
      { key: 'nvd', name: 'NIST NVD', icon: '<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>' },
      { key: 'osv', name: 'OSV.dev', icon: '<circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>' },
      { key: 'github', name: 'GitHub Advisory', icon: '<path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>' },
      { key: 'cisa_kev', name: 'CISA KEV', icon: '<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>' },
    ];
    sourceList.forEach(function(s) {
      var src = sources[s.key];
      var found = src && src.status === 'found';
      sourceHtml += '<div class="vuln-source-card ' + (found ? 'vuln-source-found' : 'vuln-source-miss') + '">'
        + '<div class="vuln-source-header">'
        + '<div class="vuln-source-name-row">'
        + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">' + s.icon + '</svg>'
        + '<span class="vuln-source-name">' + escHtml(s.name) + '</span>'
        + '</div>'
        + '<span class="vuln-source-badge ' + (found ? 'vuln-badge-found' : 'vuln-badge-miss') + '">' + (found ? 'Found' : 'Not Found') + '</span>'
        + '</div>';
      if (found && s.key === 'osv' && src.data) {
        sourceHtml += '<p class="vuln-source-detail">' + escHtml(src.data.summary || src.data.details || '') + '</p>';
        if (src.data.osv_id) sourceHtml += '<span class="vuln-source-id">' + escHtml(src.data.osv_id) + '</span>';
      }
      if (found && s.key === 'github' && src.data) {
        sourceHtml += '<p class="vuln-source-detail">' + escHtml(src.data.summary || '') + '</p>';
        if (src.data.ghsa_id) sourceHtml += '<a href="' + escHtml(src.data.html_url) + '" target="_blank" rel="noopener noreferrer" class="vuln-source-id">' + escHtml(src.data.ghsa_id) + '</a>';
      }
      if (found && s.key === 'cisa_kev' && src.data) {
        sourceHtml += '<p class="vuln-source-detail">' + escHtml(src.data.shortDescription || '') + '</p>';
      }
      sourceHtml += '</div>';
    });
    document.getElementById('vuln-source-cards').innerHTML = sourceHtml;

    // ===== Affected packages =====
    var affectedEl = document.getElementById('vuln-affected');
    var affectedList = document.getElementById('vuln-affected-list');
    var packages = [];
    if (sources.osv && sources.osv.status === 'found' && sources.osv.data && sources.osv.data.affected) {
      sources.osv.data.affected.forEach(function(a) { if (a.package) packages.push(a.package); });
    }
    if (sources.github && sources.github.status === 'found' && sources.github.data && sources.github.data.vulnerabilities) {
      sources.github.data.vulnerabilities.forEach(function(v) {
        if (v.package) packages.push(v.package + (v.vulnerable_range ? ' ' + v.vulnerable_range : '') + (v.patched ? ' (patched: ' + v.patched + ')' : ''));
      });
    }
    if (packages.length > 0) {
      affectedEl.style.display = 'block';
      affectedList.innerHTML = packages.map(function(p) {
        return '<div class="vuln-affected-item"><code>' + escHtml(typeof p === 'string' ? p : JSON.stringify(p)) + '</code></div>';
      }).join('');
    } else {
      affectedEl.style.display = 'none';
    }

    // ===== References =====
    var refsEl = document.getElementById('vuln-references');
    var refsList = document.getElementById('vuln-refs-list');
    if (data.references && data.references.length > 0) {
      refsEl.style.display = 'block';
      refsList.innerHTML = data.references.map(function(r) {
        return '<a href="' + escHtml(r.url) + '" target="_blank" rel="noopener noreferrer" class="vuln-ref-item">'
          + '<span class="vuln-ref-source">' + escHtml(r.source || new URL(r.url).hostname) + '</span>'
          + '<span class="vuln-ref-url">' + escHtml(r.url) + '</span>'
          + '</a>';
      }).join('');
    } else {
      refsEl.style.display = 'none';
    }

    // ===== External links =====
    var links = data.externalLinks;
    if (links) {
      var dbHtml = links.vulnerability_databases.map(function(l) {
        var catClass = 'vuln-link-' + l.category;
        return '<a href="' + escHtml(l.url) + '" target="_blank" rel="noopener noreferrer" class="vuln-ext-link ' + catClass + '">'
          + '<span class="vuln-ext-name">' + escHtml(l.name) + '</span>'
          + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>'
          + '</a>';
      }).join('');
      document.getElementById('vuln-db-links').innerHTML = dbHtml;

      var exHtml = links.exploit_databases.map(function(l) {
        return '<a href="' + escHtml(l.url) + '" target="_blank" rel="noopener noreferrer" class="vuln-ext-link vuln-link-exploit">'
          + '<span class="vuln-ext-name">' + escHtml(l.name) + '</span>'
          + '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>'
          + '</a>';
      }).join('');
      document.getElementById('vuln-exploit-links').innerHTML = exHtml;
    }

    // Scroll to results
    document.getElementById('vuln-header-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Auto-lookup from URL param
  var params = new URLSearchParams(window.location.search);
  var cvePre = params.get('cve');
  if (cvePre && CVE_RE.test(cvePre)) {
    input.value = cvePre.toUpperCase();
    btn.disabled = false;
    doLookup(cvePre.toUpperCase());
  }
})();
</script>

<%- include('partials/footer') %>
